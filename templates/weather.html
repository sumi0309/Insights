{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Weather - Insights</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="{% static 'css/weather.css' %}" />
  </head>
  <body>
    <div class="container">
      <h1>Get Weather Information</h1>
      <p>
        Enter your location or a landmark to get the latest weather updates.
      </p>

      <!-- Form to fetch location suggestions -->
      <form id="location-form" method="post">
        {% csrf_token %}
        <div class="mb-3">
          <input
            type="text"
            class="form-control input-custom"
            id="location"
            name="location"
            placeholder="E.g., New York, Eiffel Tower"
            required
          />
        </div>
        <button type="submit" class="btn btn-custom">
          Get Location Options
        </button>
      </form>

      <!-- Container to display location options -->
      <div id="location-options" class="mt-3" style="display: none">
        <h3>Select Your Location:</h3>
        <form id="select-location-form" method="post">
          {% csrf_token %}
          <div id="options-list" style="text-align: left"></div>
          <button type="submit" class="btn btn-custom mt-2">
            Confirm Selection
          </button>
        </form>
      </div>
    </div>

    <div class="footer">
      <p>&copy; 2025 Insights. All rights reserved.</p>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      document.getElementById("location-form").onsubmit = async function (e) {
        e.preventDefault();
        const formData = new FormData(this);
        const response = await fetch("{% url 'get_weather' %}", {
          method: "POST",
          body: formData,
        });

        const data = await response.json();
        let optionsDiv = document.getElementById("options-list");
        optionsDiv.innerHTML = "";

        if (data.display_names.length > 0) {
          data.display_names.forEach((name) => {
            optionsDiv.innerHTML += `
                      <div class="form-check">
                          <input class="form-check-input" type="radio" name="selected_display_name" value="${name}" required>
                          <label class="form-check-label">${name}</label>
                      </div>`;
          });

          document.getElementById("location-options").style.display = "block";
        } else {
          optionsDiv.innerHTML = "<p>No locations found. Try again.</p>";
        }
      };

      document.getElementById("select-location-form").onsubmit =
        async function (e) {
          e.preventDefault();
          const formData = new FormData(this);
          const response = await fetch("{% url 'select_location' %}", {
            method: "POST",
            body: formData,
          });

          const selectedData = await response.json();
          console.log("Selected Location Data:", selectedData);
          alert("Selected location: " + selectedData.display_name);
        };
    </script>
  </body>
</html>
